<p-toast></p-toast>
<div class="mb-3" *ngIf="this.quote">
    <div [ngClass]="{'overlay': quickView}" (click)="this.quickView = false"></div>
    <div class="grid">
        <div class="">
            <p-sidebar [(visible)]="visibleSidebar" position="right" styleClass="p-sidebar-md" [baseZIndex]="1"
                [style]="{'width':'32%'}">
                <app-query-discussion-box *ngIf="visibleSidebar" [quote]="this.quote"></app-query-discussion-box>
            </p-sidebar>
        </div>
        <p-dialog [header]="message" [(visible)]="displayBasic" styleClass="customPopup" [style]="{width: '50vw'}">
        </p-dialog>
        <div class="col sidebar" style="max-width: 360px">
            <div class="p-3" data-aos="fade-left">
                <div class="text-center mb-3" id="QuoteComparisoReview_StepsImage">
                    <img src="/assets/step3-pic.png" width="80px" alt="">
                </div>
                <div class="px-3">
                    <h4 id="QuoteComparisoReview_QuoteNo">Reference No: {{this.quote.quoteNo}}</h4>
                    <p id="QuoteComparisoReview_ProductType">
                        {{this.quote.productId.type}}
                    </p>
                </div>
            </div>
            <div class="" data-aos="fade-up">
                <div class="p-3 ">
                    <ul>
                        <!-- <li [class]="'tab-item ' + (index == i ? 'active' : '') " *ngFor="let tab of this.tabs; let i = index" (click)="setIndex(i)">
                            <div class="flex align-items-start p-3">
                                <i [class]="'pi pi-chevron-right mt-1 mr-3' "></i> <span>{{tab.label}}</span>
                            </div>

                        </li> -->

                        <li *ngFor="let tab of this.tabs"
                            [class]="'tab-item ' + (selectedTabId === tab.id ? 'active' : '')"
                            (click)="this.selectTab(tab)" id="QuoteComparisoReview_SelectTab">
                            <div class="flex align-items-start p-3">
                                <i [class]="'pi pi-chevron-right mt-1 mr-3' "></i> <span>{{tab.label}}</span>
                            </div>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
        <div class="col ">
            <div class="p-3">
                <div class="edit-quote-link-container mb-3">
                    <div class="flex align-items-center justify-content-between custom-detail-header py-3 px-5">
                        <div class="mb-3" data-aos="fade-right">
                            <strong>
                                <!-- when there is version in quote option  -->
                                <a style="color: blue;"> <i class="pi pi-chart-bar mr-3" style="font-size: 1.5rem"
                                        id="QuoteComparisoReview_ViewAnalytics"></i> {{
                                    this.quoteOptionData?.hasOwnProperty('qcrVersion') ?
                                    ('Quote Comparison Report (QCR) - ' + this.quoteOptionData?.qcrVersion) :
                                    'Quote Comparison Report (QCR)' }}
                                </a>
                            </strong>

                        </div>
                        <!-- <div class="d-flex align-items-center">
                            <button class="btn btn-info mr-4" id="SidSumInsured_Split_Download"
                                (click)="downloadExcel()">
                                <i class="pi pi-download"></i> Download Excel
                            </button>
                        </div> -->
                        <div>
                            <button class="btn btn-success mr-4" id="OTCProductLimitDialog_Accept"
                                (click)="downloadExcel()">Download QCR Excel</button>
                        </div>
                        <div>
                            <button class="mr-3 btn btn-lg btn btn-primary"
                                *ngIf="this.user._id == this.quote.assignedToPlacementMakerId"
                                (click)="this.qcrEdit()">QCR Edit</button>

                            <button class="mr-3 btn btn-lg btn btn-primary" (click)="toggleQuickView()">Quick QCR
                                View</button>
                        </div>
                        <div *ngIf="this.user.partnerId['brokerModeStatus']">
                            <div
                                *ngIf="this.user._id == this.quote?.assignedToPlacementMakerId && !this.quote.qcrApprovedRequested">
                                <button class="btn btn-lg btn-primary" type="button"
                                    (click)="sendQuoteForApproval()">Send for approval</button>
                            </div>
                            <div
                                *ngIf="this.user._id == this.quote?.assignedToPlacementMakerId && this.quote?.qcrApprovedRequested && !this.quote?.qcrApproved">
                                <button class="btn btn-lg btn-primary mr-2" type="button" disabled
                                    style="background-color: blue !important;color: white !important;">QCR Sent for
                                    approval</button>
                            </div>
                            <div
                                *ngIf="this.user._id == this.quote?.assignedToPlacementMakerId && this.quote?.qcrApprovedRequested && this.quote?.qcrApproved">
                                <button class="btn btn-lg btn-primary mr-2" type="button" disabled
                                    style="background-color: blue !important;color: white !important;">QCR Approved by
                                    Checker</button>
                            </div>
                            <div
                                *ngIf="this.user._id == this.quote?.assignedToPlacementCheckerId && !this.quote.qcrApproved && this.quote?.qcrApprovedRequested">
                                <!-- <i class="pi pi-comments mr-3 button" style="font-size: 2rem;color : blue"
                                    (click)="visible()" position="right"></i> -->
                                <button class="mr-3 btn btn-lg btn btn-primary" (click)="this.pushBackTo()">Push
                                    Back</button>
                                <button class="btn btn-lg btn-primary mr-2" type="button"
                                    (click)="sendQuoteForApprovalbymaker()">Approve</button>
                            </div>
                            <div
                                *ngIf="this.user._id == this.quote?.assignedToPlacementCheckerId && this.quote?.qcrApprovedRequested && this.quote?.qcrApproved">
                                <button class="btn btn-lg btn-primary mr-2" type="button" disabled>QCR Approved</button>
                            </div>
                        </div>
                        <!-- <div class="mb-3">
                        <button id="broker" class="btn btn-primary" style="border-top-right-radius: unset; border-bottom-right-radius: unset;" (click)="navigateToBrokerComp()">Broker-wise Comparison</button>
                        <button class="btn btn-outline-blue" style="border-top-left-radius: unset; border-bottom-left-radius: unset;" (click)="navigateToYearComp()">Yearly Comparison</button>
                    </div>
                    <div class="mb-3">
                        <button class="btn btn-primary" (click)="navigateToRequestApproval()">Next</button>
                    </div> -->
                    </div>
                </div>
                <div style="display: flex; justify-content: space-between; align-items: center; width: 100%;">
                    <!-- New_Quote_Option -->
                    <div class="px-3 w-4">
                        <p-dropdown [filter]="true" [filterBy]="'label'" id="requisitionTab_handleOptions"
                            placeholder="Select Option" [(ngModel)]="selectedQuoteOption"
                            (onChange)="handleQuoteOptionChangeLiability($event)" [options]="optionsQuoteOptions"
                            field="label"></p-dropdown>
                    </div>
                    <!-- <div class="col-3">
                        <p-dropdown [(ngModel)]="this.selectedQuoteLocationOccupancy"
                            [options]="this.optionsQuoteLocationOccupancies" [filter]="true"
                            (ngModelChange)="this.onChangeQuoteLocationOccupancy($event)">
                        </p-dropdown>
                    </div> -->

                    <div style="display: flex; flex-direction: column; align-items: flex-end;">
                        <form [formGroup]="sendLinkForm" (ngSubmit)="onSubmit()" class="flex-form"
                            style="display: flex; align-items: center;">
                            <input pInputText type="text" formControlName="email"
                                style="width: 207px; margin-right: 10px;" placeholder="Please enter your email">
                            <button class="btn btn-primary" type="submit">Send Link</button>
                        </form>
                    </div>
                </div>
                <div class="p-3">
                    <div class="quote-comparision-table" *ngIf="this.selectedTabId">
                        <table>
                            <tr class="header">
                                <th [style]="col.style" *ngFor="let col of cols" id="QuoteComparisoReview_BrokerLabel"
                                    [ngClass]="{'text-right' : this.selectedTabId =='add_ons' || this.selectedTabId == 'sum_insured_details' || this.selectedTabId == 'business_suraksha_covers'}">
                                    {{col.label}}
                                </th>
                            </tr>
                            <tr *ngFor="let item of mapping">
                                <td [style]="col.style" class="text-left" *ngFor="let col of cols">
                                    <div class="">
                                        <div class="" [style.color]="item[col.id].styleaddon"
                                            *ngIf="item[col.id]?.type == 'string'" id="QuoteComparisoReview_value"
                                            [ngClass]="{'text-right' : item[col.id]?.isAlignmentRequired}"
                                            [style.color]="item[col.id].styleaddon">
                                            {{item[col.id]?.value ?? ''}}
                                        </div>
                                        <div class="" *ngIf="item[col.id]?.type == 'html'"
                                            id="QuoteComparisoReview_value2">
                                            <div [innerHtml]="item[col.id]?.value"></div>
                                        </div>
                                        <div class="" *ngIf="item[col.id]?.type == 'button'"
                                            id="QuoteComparisoReview_ItemIdValue"
                                            [ngClass]="{'text-right' : this.selectedTabId =='add_ons' || this.selectedTabId == 'sum_insured_details' || this.selectedTabId == 'business_suraksha_covers'}">
                                            <button [class]="item[col.id].buttonClassName"
                                                (click)="item[col.id].onClick()">{{item[col.id].value}}</button>
                                        </div>
                                        <div class="" *ngIf="item[col.id]?.type == 'buttons'"
                                            id="QuoteComparisoReview_ButtonValue"
                                            [ngClass]="{'text-right' : this.selectedTabId =='add_ons' || this.selectedTabId == 'sum_insured_details' || this.selectedTabId == 'business_suraksha_covers'}">
                                            <button *ngFor="let button of item[col.id]?.buttons"
                                                [disabled]="button.disabled" [class]="button.buttonClassName"
                                                (click)="button.onClick()">{{button.value}}</button>
                                        </div>
                                        <!-- <div *ngIf="this.quote.qcrApproved != null ? true : false">
                                            <div class="" *ngIf="item[col.id]?.type == 'buttons'" [class]="button?.buttonClassName"
                                            id="QuoteComparisoReview_ButtonValue">
                                            <button (click)="button.onClick()">Send For Approval</button>
                                        </div>
                                        </div> -->
                                        <div class="" *ngIf="item[col.id]?.type == 'boolean'"
                                            id="QuoteComparisoReview_ItemValue"
                                            [ngClass]="{'text-right' : this.selectedTabId == 'add_ons'}">
                                            <i *ngIf="item[col.id]?.value" class="pi pi-check"></i>
                                            <i *ngIf="!item[col.id]?.value" class="pi pi-times"></i>
                                        </div>
                                        <div class="" *ngIf="item[col.id]?.type == 'tickOrValue'"
                                            id="QuoteComparisoReview_TicketOrValue">
                                            <div *ngIf="item[col.id]?.value" id="QuoteComparisoReview_IdValue">
                                                {{item[col.id]?.value}}</div>
                                            <i *ngIf="!item[col.id]?.value" class="pi pi-check"
                                                id="QuoteComparisoReview_NotIdValue"></i>
                                        </div>
                                        <div class="" *ngIf="item[col.id]?.type == 'currency'"
                                            id="QuoteComparisoReview_Currency"
                                            [ngClass]="{'text-right' : this.selectedTabId =='add_ons' || this.selectedTabId == 'sum_insured_details' || this.selectedTabId == 'business_suraksha_covers'}">
                                            <!-- â‚¹ {{item[col.id]?.value?.toLocaleString('en-IN') ?? ''}} -->
                                            <span [style.color]="item[col.id].styleaddon"><app-currency
                                                    [maximumFractionDigits]="0"
                                                    [value]="(item[col.id]?.value ?? 0)"></app-currency></span>
                                        </div>


                                        <div *ngIf="item[col.id]?.type == 'string'" class="bank-details">
                                            <!-- Display Label and Value for Bank Details -->
                                            <div *ngIf="col.id === 'Reference No'">
                                                <strong>Reference No:</strong> {{ item[col.id]?.value }}
                                            </div>
                                            <div *ngIf="col.id === 'Cheque No'">
                                                <strong>Cheque No:</strong> {{ item[col.id]?.value }}
                                            </div>
                                            <div *ngIf="col.id === 'Bank Name'">
                                                <strong>Bank Name:</strong> {{ item[col.id]?.value }}
                                            </div>
                                            <div *ngIf="col.id === 'Payment Date'">
                                                <strong>Payment Date:</strong> {{ item[col.id]?.value }}
                                            </div>
                                            <div *ngIf="col.id === 'Payment Amount'">
                                                <strong>Payment Amount:</strong> {{ item[col.id]?.value | currency:'INR'
                                                }}
                                            </div>
                                        </div>


                                    </div>
                                </td>
                            </tr>
                        </table>
                        <!-- <p-table [value]="this.mapping" responsiveLayout="scroll">
                            <ng-template pTemplate="header">
                                <tr class="header">
                                    <th [style]="col.style" class="text-left" *ngFor="let col of cols" id="QuoteComparisoReview_BrokerLabel" [ngClass]="{'text-right' : this.selectedTabId =='add_ons' || this.selectedTabId == 'sum_insured_details' || this.selectedTabId == 'business_suraksha_covers'}">
                                        {{col.label}}
                                    </th>
                                </tr>
                            </ng-template>
                            <ng-template pTemplate="body" let-item let-mappingIndex="rowIndex">
                                <tr>
                                    <td [style]="col.style" class="text-left" *ngFor="let col of cols">

                                        <div class="" >

                                            <div class="" *ngIf="item[col.id]?.type == 'string'" id="QuoteComparisoReview_value" [ngClass]="{'text-right' : item[col.id]?.isAlignmentRequired}" [style.color]="item[col.id].styleaddon">
                                                {{item[col.id]?.value ?? ''}}
                                            </div>
                                            <div class="" *ngIf="item[col.id]?.type == 'html'" id="QuoteComparisoReview_value2">
                                                <div [innerHtml]="item[col.id]?.value"></div>
                                            </div>
                                            <div class="" *ngIf="item[col.id]?.type == 'button'" id="QuoteComparisoReview_ItemIdValue" [ngClass]="{'text-right' : this.selectedTabId =='add_ons' || this.selectedTabId == 'sum_insured_details' || this.selectedTabId == 'business_suraksha_covers'}">
                                                <button [class]="item[col.id].buttonClassName" (click)="item[col.id].onClick()">{{item[col.id].value}}</button>
                                            </div>
                                            <div class="" *ngIf="item[col.id]?.type == 'buttons'" id="QuoteComparisoReview_ButtonValue" [ngClass]="{'text-right' : this.selectedTabId =='add_ons' || this.selectedTabId == 'sum_insured_details' || this.selectedTabId == 'business_suraksha_covers'}">
                                                <button *ngFor="let button of item[col.id]?.buttons" [class]="button.buttonClassName" (click)="button.onClick()">{{button.value}}</button>
                                            </div>
                                            <div class="" *ngIf="item[col.id]?.type == 'boolean'" id="QuoteComparisoReview_ItemValue" [ngClass]="{'text-right' : this.selectedTabId == 'add_ons'}">
                                                <i *ngIf="item[col.id]?.value" class="pi pi-check" style="font-weight: 700; color: green"></i>
                                                <i *ngIf="!item[col.id]?.value" class="pi pi-times" style="font-weight: 700;color: red"></i>
                                            </div>
                                            <div class="" *ngIf="item[col.id]?.type == 'tickOrValue'" id="QuoteComparisoReview_TicketOrValue">
                                                <div *ngIf="item[col.id]?.value" id="QuoteComparisoReview_IdValue">{{item[col.id]?.value}}</div>
                                                <i *ngIf="!item[col.id]?.value" class="pi pi-check" id="QuoteComparisoReview_NotIdValue" style="font-weight: 700; color: green"></i>
                                            </div>
                                            <div class="" *ngIf="item[col.id]?.type == 'currency'" id="QuoteComparisoReview_Currency" [ngClass]="{'text-right' : this.selectedTabId =='add_ons' || this.selectedTabId == 'sum_insured_details' || this.selectedTabId == 'business_suraksha_covers'}">
                                                <span [style.color]="item[col.id].styleaddon"><app-currency [maximumFractionDigits]="0" [value]="(item[col.id]?.value ?? 0)"></app-currency></span>
                                            </div>
                                        </div>
                                    </td>
                                </tr>

                            </ng-template>
                        </p-table> -->
                    </div>

                </div>
                <!-- <div class="col-10" *ngIf="(this.quote?.productId?.type == 'Fire Insurance Policy') && this.quote && this.quote.quoteType == 'existing'"> -->
                <!-- <div class="col-12" *ngIf="this.quote">
                    <p-card *ngIf="this.selectedTabId=='risk_inspection_status_and_claim_experience'"> -->
                <!-- <ul style="list-style-type: none;padding: 0;margin: 0;text-align: right">
                            <i class="pi pi-angle-right" style="font-size: 2rem" (click)="openDropDown()" *ngIf="isOpenErrow"></i>
                            <i class="pi pi-angle-down" style="font-size: 2rem" (click)="closeDropDown()" *ngIf="isCloseErrow"  ></i>
                        </ul> -->
                <!-- <div>
                            <div class=" tblz01-pdf mt-4">
                                <table class="" style="width:100%">
                                    <tbody class="">
                                        <tr>
                                            <td colspan="6" class="text-black">Claim Experience</td>
                                        </tr>
                                        <tr>
                                            <td id="QuoteComparisoReview_Year_Label">Year</td>
                                            <td id="QuoteComparisoReview_Year"
                                                *ngFor="let claim of this.claimExperiences">{{claim['year']-1}} -
                                                {{claim['year']}} </td>
                                        </tr>
                                        <tr>
                                            <td id="QuoteComparisoReview_PremiumPaid_Label">Premium Paid </td> -->
                <!-- <td id="QuoteComparisoReview_PremiumPaid" *ngFor="let claim of this.claimExperiences">{{(claim.premiumPaid ?? 0)?.toLocaleString('en-IN' , {style: 'currency', currency: 'INR'})}}</td> -->
                <!-- <td id="QuoteComparisoReview_ClaimAmount"
                                                *ngFor="let claim of this.claimExperiences"><span><app-currency
                                                        [value]="(claim.premiumPaid ?? 0)"></app-currency></span></td>

                                        </tr>
                                        <tr>
                                            <td id="QuoteComparisoReview_ClaimAmount_Label">claim Amount </td> -->
                <!-- <td id="QuoteComparisoReview_ClaimAmount" *ngFor="let claim of this.claimExperiences">{{(claim.claimAmount ?? 0)?.toLocaleString('en-IN' , {style: 'currency', currency: 'INR'})}}</td> -->
                <!-- <td id="QuoteComparisoReview_ClaimAmount"
                                                *ngFor="let claim of this.claimExperiences"><span><app-currency
                                                        [value]="(claim.claimAmount ?? 0)"></app-currency></span></td>

                                        </tr>
                                        <tr>
                                            <td id="QuoteComparisoReview_NoOfClaims_Label">No. of claims</td>
                                            <td id="QuoteComparisoReview_NoOfClaims"
                                                *ngFor="let claim of this.claimExperiences">{{claim.numberOfClaims ??
                                                0}}</td>
                                        </tr>
                                        <tr>
                                            <td id="QuoteComparisoReview_NatureOfClaim_Label">Nature of claim</td>
                                            <td id="QuoteComparisoReview_NatureOfClaim"
                                                *ngFor="let claim of this.claimExperiences">{{(claim.natureOfClaim ??
                                                'N/A')}}</td>
                                        </tr>
                                    </tbody>

                                </table>
                            </div>
                        </div>
                    </p-card>

                </div> -->
            </div>
        </div>

    </div>
</div>

<!-- Quick View Toggler -->
<div class="p-3 quickView" *ngIf="this.quickView">
    <div class="quote-comparision-table">
        <table>
            <tr class="header">
                <th [style]="col.style" class="text-align-center" *ngFor="let col of cols"
                    id="QuoteComparisoReview_BrokerLabel">
                    {{col.label}}
                </th>
            </tr>
            <tr *ngFor="let item of mappingQCRArr">

                <td class="text-left" *ngFor="let col of cols">

                    <div class="">
                        <div class="quickViewHeaderWrapper">
                <th class="quickViewHeader" *ngIf="item[col.id]?.type == 'header'" id="QuoteComparisoReview_value">
                    {{item[col.id]?.value ?? ''}}
                </th>
    </div>

    <div class="cells" [style.color]="item[col.id].styleaddon" *ngIf="item[col.id]?.type == 'string'"
        id="QuoteComparisoReview_value" [ngClass]="{'text-right' : item[col.id]?.isAlignmentRequired }"
        [style.color]="item[col.id].styleaddon">
        {{item[col.id]?.value ?? ''}}
    </div>
    <div class="cells" *ngIf="item[col.id]?.type == 'html'" id="QuoteComparisoReview_value2">
        <div [innerHtml]="item[col.id]?.value"></div>
    </div>
    <div class="cells" *ngIf="item[col.id]?.type == 'boolean'" id="QuoteComparisoReview_ItemValue"
        [ngClass]="{'text-right' : this.selectedTabId == 'add_ons'}">
        <i *ngIf="item[col.id]?.value" class="pi pi-check" style="font-weight: 700; color: green"></i>
        <i *ngIf="!item[col.id]?.value" class="pi pi-times" style="font-weight: 700;color: red"></i>
    </div>
    <div class="cells" *ngIf="item[col.id]?.type == 'tickOrValue'" id="QuoteComparisoReview_TicketOrValue">
        <div *ngIf="item[col.id]?.value" id="QuoteComparisoReview_IdValue">{{item[col.id]?.value}}</div>
        <i *ngIf="!item[col.id]?.value" class="pi pi-check" id="QuoteComparisoReview_NotIdValue"
            style="font-weight: 700; color: green"></i>
    </div>
    <div class="cells text-right" *ngIf="item[col.id]?.type == 'currency'" id="QuoteComparisoReview_Currency">
        <span [style.color]="item[col.id].styleaddon"><app-currency [maximumFractionDigits]="0"
                [value]="(item[col.id]?.value ?? 0)"></app-currency></span>
    </div>
</div>
</td>
</tr>
</table>
</div>
</div>