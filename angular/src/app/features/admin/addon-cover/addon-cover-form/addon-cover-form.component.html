<p-tabView>
    <p-tabPanel header="Addon Cover Details">
        <form [formGroup]="this.recordForm">
            <div class="form-container">
                <div class="grid">
                    <div class="col-12">
                        <div class="card p-fluid">
                            <p-toast></p-toast>
                            <p-toolbar styleClass="">
                                <ng-template pTemplate="left">
                                    <h3 class="mb-0">{{this.recordSingularName}}</h3>
                                </ng-template>
                                <ng-template pTemplate="right">
                                    <button type="submit" pButton pRipple label="Save" icon="pi pi-check"
                                        class="p-button-success mr-2" (click)="this.saveRecord()"></button>
                                    <button pButton pRipple label="Cancel" icon="pi pi-times"
                                        class="p-button-danger mr-2 pr-3" (click)="this.onCancel()"></button>
                                </ng-template>
                            </p-toolbar>
                        </div>
                    </div>
                    <div class="col">
                        <div class="grid">
                            <div class="col-12 md:col-6">

                                <div class="card p-fluid">
                                    <h5>General Information</h5>
                                    <div class="field">
                                        <label for="name">Partner</label>
                                        <p-autoComplete [disabled]="this.mode == 'edit'" [dropdown]="true"
                                            optionValue="value" field="label" formControlName="partnerId"
                                            [suggestions]="this.optionsPartners"
                                            (completeMethod)="this.searchOptionsPartners($event)"
                                            [ngClass]="{'ng-invalid ng-dirty': submitted && !recordForm.controls['partnerId'].valid}"
                                            (onSelect)="handleOnPartnerChange($event)"></p-autoComplete>
                                        <small *ngIf="this.recordForm.controls['partnerId'].errors?.required"
                                            class="ng-invalid">This field Required.</small>
                                    </div>
                                    <div class="field">
                                        <label for="productId">Product</label>
                                        <p-autoComplete [dropdown]="true" [suggestions]="this.optionsProducts"
                                            field="label" formControlName="productId" [disabled]="this.mode == 'edit'"
                                            (completeMethod)="this.searchOptionsProducts($event)"
                                            (onSelect)="handleOnproductChange($event)"
                                            [ngClass]="{'ng-invalid ng-dirty': submitted && !recordForm.controls['productId'].valid}"></p-autoComplete>
                                    </div>
                                    <div class="field">
                                        <label for="sectorId">Sector</label>
                                        <p-autoComplete [dropdown]="true" [suggestions]="this.optionsSectors"
                                            field="label" formControlName="sectorId"
                                            (completeMethod)="this.searchOptionsSector($event)"
                                            [ngClass]="{'ng-invalid ng-dirty': submitted && !recordForm.controls['sectorId'].valid}"></p-autoComplete>
                                    </div>
                                    <div class="field">
                                        <label for="occupancyId">Occupancy</label>
                                        <p-autoComplete [disabled]="this.mode == 'edit'" [dropdown]="true"
                                            [suggestions]="this.optionOccupancy" field="label"
                                            formControlName="occupancyId"
                                            (completeMethod)="this.searchOptionsOccupancy($event)"
                                            [ngClass]="{'ng-invalid ng-dirty': submitted && !recordForm.controls['occupancyId'].valid}"></p-autoComplete>
                                    </div>
                                    <div class="field">
                                        <label for="name">Name</label>
                                        <input maxlength="255" class="form-control" type="text" pInputText id="name"
                                            formControlName="name" required autofocus
                                            [ngClass]="{'ng-invalid ng-dirty': submitted && !recordForm.value['name']}" />
                                        <small class="ng-dirty ng-invalid"
                                            *ngIf="submitted && !recordForm.value['name']">Name is required.</small>
                                        <!-- <small class="ng-dirty ng-invalid" *ngIf="recordForm.controls['name'].errors?.maxlength">Name cannot be more than 255 Characters.</small> -->
                                    </div>


                                    <!--Liability-->

                                    <div class="field" *ngIf="this.isLiabilityProduct">
                                        <label for="addonCoverOptions">Is applicable for ?</label>
                                        <p-multiSelect id="AddonCoverForm_transitTypes"
                                            [options]="this.optionsIBusinessActivity"
                                            formControlName="insuredBusinessActivityOptions"
                                            placeholder="Select Options"
                                            (onChange)="this.insuredBusinessActivityChange($event.value)"
                                            [(ngModel)]="this.selectedInsuredBusinessActivity"
                                            optionLabel="label"></p-multiSelect>
                                    </div>

                                    <div class="field" *ngIf="this.isLiabilityProductCGL">
                                        <label for="typeOfProductOptions">Is applicable for ?</label>
                                        <p-multiSelect id="typeOfProduct_transitTypes"
                                            [options]="this.optionITypeOfProduct"
                                            formControlName="typeOfProductOptions"
                                            placeholder="Select Options"
                                            (onChange)="this.insuredTypeOfProduct($event.value)"
                                            [(ngModel)]="this.selectedTypeOfProduct"
                                            optionLabel="label"></p-multiSelect>
                                    </div>

                                    <div class="field" *ngIf="this.isLiabilityProduct || this.isLiabilityProductCGL">
                                        <label for="addonCoverOptions">Addon Cover Options</label>
                                        <p-multiSelect id="AddonCoverForm_transitTypes"
                                            [options]="this.optionsAddOncovers" formControlName="addonCoverOptions"
                                            placeholder="Select Options"
                                            (onChange)="this.addonsOptionsWiseFilterChanged($event.value)"
                                            [(ngModel)]="this.selectedAddonCoverOptions"
                                            optionLabel="label"></p-multiSelect>
                                    </div>

                                    <div class="field">
                                        <label for="category">Section</label>
                                        <p-dropdown [disabled]="this.mode == 'edit'" class="form-control"
                                            [options]="this.optionsAddonCategories" placeholder="Category"
                                            optionLabel="label" optionValue="value" [showClear]="true"
                                            formControlName="category"
                                            [ngClass]="{'ng-invalid ng-dirty': submitted && !recordForm.controls['category'].valid}"></p-dropdown>
                                        <small class="ng-dirty ng-invalid"
                                            *ngIf="submitted && !recordForm.value['category']">Category is
                                            required.</small>
                                    </div>
                                    <!-- <div class="field">
                                        <label for="subCategory">Sub Category</label>
                                        <input class="form-control" type="text" pInputText id="subCategory" formControlName="subCategory" />
                                    </div> -->
                                    <!-- <div class="field">
                                        <label for="claimClause">Claim Clause</label>
                                        <input class="form-control" type="text" pInputText id="claimClause" formControlName="claimClause" />
                                    </div> -->
                                    <!-- <div class="field">
                                        <label for="categoryOfImportance">Category Of Importance</label>
                                        <input class="form-control" type="text" pInputText id="categoryOfImportance" formControlName="categoryOfImportance" />
                                        <small class="ng-dirty ng-invalid" *ngIf="submitted && !recordForm.value['categoryOfImportance']">Category Of Importance is required.</small>
                                    </div> -->
                                    <!-- <div class="field">
                                        <label for="sequenceNo">Sequence No</label>
                                        <input class="form-control" type="text" pInputText id="sequenceNo" formControlName="sequenceNo" />
                                    </div> -->
                                    <!-- <div class="field">
                                        <label for="policyType">Policy Type</label>
                                        <input class="form-control" type="text" pInputText id="policyType" formControlName="policyType" />
                                    </div> -->
                                    <div class="field">
                                        <label for="addonTypeFlag">Add On Type</label>
                                        <p-dropdown class="form-control" [options]="this.optionsAddonTypeFlags"
                                            placeholder="Add On Type" optionLabel="label" optionValue="value"
                                            [showClear]="true" formControlName="addonTypeFlag"
                                            [ngClass]="{'ng-invalid ng-dirty': submitted && !recordForm.controls['addonTypeFlag'].valid}"></p-dropdown>
                                        <small class="ng-dirty ng-invalid"
                                            *ngIf="submitted && !recordForm.value['addonTypeFlag']">Add On Type is
                                            required.</small>
                                    </div>
                                    <div class="field" *ngIf="this.carProduct">
                                        <label for="addonTypeFlag">SI limit</label>
                                        <p-dropdown class="form-control" [options]="this.optionSILimit"
                                            placeholder="Add SI limit" optionLabel="label" optionValue="value"
                                            [showClear]="true" formControlName="isAbv100cr"></p-dropdown>
                                    </div>
                                    <div class="field">
                                        <label for="categoryOfImportance">Category Of Importance</label>
                                        <p-dropdown class="form-control" [options]="this.optionsCategoryOfImportance"
                                            placeholder="Category Of Importance" optionLabel="label" optionValue="value"
                                            [showClear]="true" formControlName="categoryOfImportance"
                                            [ngClass]="{'ng-invalid ng-dirty': submitted && !recordForm.controls['categoryOfImportance'].valid}"></p-dropdown>
                                        <small class="ng-dirty ng-invalid"
                                            *ngIf="submitted && !recordForm.value['categoryOfImportance']">Category Of
                                            Importance is
                                            required.</small>
                                    </div>
                                    <div class="field">
                                        <label for="freeUpToNumber">Free UpTo Number</label>
                                        <input class="form-control" type="number" pInputText id="freeUpToNumber"
                                            formControlName="freeUpToNumber" />
                                        <!-- <small class="ng-dirty ng-invalid" *ngIf="recordForm.controls['freeUpToNumber'].errors?.max">FreeUp Number cannot be more than 11 Characters.</small> -->
                                    </div>
                                    <div class="field">
                                        <label for="freeUpToText">Free UpTo Text</label>
                                        <input maxlength="255" class="form-control" type="text" pInputText
                                            id="freeUpToText" formControlName="freeUpToText" />
                                        <!-- <small class="ng-dirty ng-invalid" *ngIf="recordForm.controls['freeUpToText'].errors?.maxlength">FreeUp Text cannot be more than 255 Characters..</small> -->
                                    </div>
                                    <div class="field">
                                        <label for="description">Description</label>
                                        <input maxlength="255" class="form-control" type="text" pInputText
                                            id="description" formControlName="description" />
                                    </div>
                                    <!-- <div class="field">
                                        <label for="freeUpToFlag">Free UpTo Flag</label>
                                        <input class="form-control" type="text" pInputText id="freeUpToFlag" formControlName="freeUpToFlag" />
                                    </div> -->
                                    <!-- <div class="field">
                                        <label for="freeUpToParameter">Free UpTo Parameter</label>
                                        <input class="form-control" type="text" pInputText id="freeUpToParameter" formControlName="freeUpToParameter" />
                                    </div> -->
                                    <div class="field">
                                        <label for="applicableFrom">Applicable From</label>
                                        <!-- <input class="form-control" type="text" pInputText id="effectiveFrom" formControlName="effectiveFrom" /> -->
                                        <p-calendar [disabled]="this.mode == 'edit'" class="form-control" type="date"
                                            [showIcon]="true" id="applicableFrom" formControlName="applicableFrom"
                                            dateFormat="yy-mm-dd"></p-calendar>

                                    </div>
                                    <div class="field">
                                        <label for="applicableTo">Applicable To</label>
                                        <!-- <input class="form-control" type="text" pInputText id="effectiveTo" formControlName="effectiveTo" /> -->
                                        <p-calendar class="form-control" type="date" [showIcon]="true" id="applicableTo"
                                            formControlName="applicableTo" dateFormat="yy-mm-dd"></p-calendar>
                                    </div>

                                </div>


                            </div>
                            <div class="col-12 md:col-6">
                                <div class="card p-fluid">
                                    <div *ngIf="isHide">
                                        <h5>Rates</h5>
                                        <div class="field">
                                            <label for="rateType">Rate Type</label>
                                            <p-dropdown class="form-control" [options]="this.optionsAddonRateTypes"
                                                placeholder="Rate Type" optionLabel="label" optionValue="value"
                                                [showClear]="true" formControlName="rateType"></p-dropdown>
                                            <div
                                                *ngIf="!rateType?.valid && (rateType?.dirty || rateType?.touched || submitted)">
                                                <div [hidden]="!rateType.errors.max">
                                                    <small class="ng-dirty ng-invalid">Rate Type is required.</small>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="field" *ngIf="!this.carProduct">
                                            <label for="rate">Rate</label>
                                            <input class="form-control" type="text" pInputText id="rate"
                                                formControlName="rate" />
                                            <div *ngIf="!rate?.valid && (rate?.dirty || rate?.touched || submitted)">
                                                <div [hidden]="!rate.errors.max">
                                                    <small class="ng-dirty ng-invalid">Rate cannot be more than
                                                        50.</small>
                                                </div>
                                            </div>
                                        </div>
                                        <!-- <div class="field">
                                        <label for="rate">Tenurewise Rate</label>
                                        <input class="form-control" type="text" pInputText id="rate"
                                            formControlName="tenurewiseRate" />
                                        <--- <div *ngIf="!tenurewiseRate?.valid && (tenurewiseRate?.dirty || tenurewiseRate?.touched || submitted)">
                                            <div [hidden]="!tenurewiseRate.errors.max">
                                                <small class="ng-dirty ng-invalid">Tenurewise Rate cannot be more than 50.</small>
                                            </div>
                                        </div>--
                                    </div> -->
                                    </div>
                                    <div *ngIf="this.hideLimit" formArrayName="rateLimit">
                                        <div class="field" *ngFor="let rateGroup of rateLimit.controls; let i = index">
                                            <div [formGroupName]="i"> 
                                                <div class="field">
                                                    <label for="addonTypeFlag">limits</label>
                                                    <p-dropdown class="form-control" [options]="this.optionsRatelimits"
                                                        placeholder="Limits" optionLabel="label" optionValue="value"
                                                        [showClear]="true" formControlName="limits"
                                                        [ngClass]="{'ng-invalid ng-dirty': submitted && !recordForm.controls['limits'].valid}"></p-dropdown>
                                                    <small class="ng-dirty ng-invalid"
                                                        *ngIf="submitted && !recordForm.value['limits']">Add On Type is
                                                        required.</small>
                                                </div>
                                                <!-- <div class="field">
                                                <input class="form-control" type="text" pInputText formControlName="limits" placeholder="Limits">
                                                </div> -->
                                                <div class="field">
                                                    <input class="form-control" pInputText formControlName="rate"
                                                        type="number" placeholder="Rate">
                                                </div>
                                                <button pButton pRipple label="Delete rates"
                                                    (click)="deleteRateLimit(i)" icon="pi pi-check"
                                                    class="p-button-danger mr-2"></button>
                                            </div>
                                        </div>
                                    </div>

                                    <button *ngIf="this.carProduct" pButton pRipple label="Add Rate Limit"
                                        (click)="addRateLimit()" icon="pi pi-check"
                                        class="p-button-success mr-2"></button>


                                    <div class="field"
                                        *ngIf="this.mode == 'edit' && this.user?.partnerId?.partnerType == 'self' && recordForm.controls.taskStatus.value">
                                        <label for="taskStatus" id="AddonCoverForm_taskStatusLabel">Task Status</label>
                                        <input id="AddonCoverForm_taskStatus" class="form-control" type="text"
                                            pInputText id="taskStatus" formControlName="taskStatus" />
                                    </div>

                                    <div class="field"
                                        *ngIf="this.mode == 'edit' && this.user?.partnerId?.partnerType == 'self' && recordForm.controls.taskStatus.value == 'failed'">
                                        <label for="failedMessage" id="AddonCoverForm_failedMessageLabel">Failed
                                            Reasson</label>
                                        <input id="AddonCoverForm_failedMessage" class="form-control" type="text"
                                            pInputText id="failedMessage" formControlName="failedMessage" />
                                    </div>
                                    <!-- <div class="field">
                                        <label for="rateParameter">Rate Parameter</label>
                                        <input class="form-control" type="text" pInputText id="rateParameter" formControlName="rateParameter" />
                                    </div> -->
                                    <!-- <div class="field">
                                        <label for="sumInsured">Sum Insured</label>
                                        <input class="form-control" type="number" pInputText id="sumInsured" formControlName="sumInsured" />
                                    </div> -->
                                    <!-- <div class="field">
                                        <label for="calculatedIndicativePremium">Calculated Indicative Premium</label>
                                        <input class="form-control" type="number" pInputText id="calculatedIndicativePremium" formControlName="calculatedIndicativePremium" />
                                    </div> -->
                                </div>

                                <!-- <div class="card p-fluid">
                                    <h5>Addon</h5>
                                    <div class="field">
                                        <label for="isFree">IsFree</label>
                                        <p-toggleButton class="form-control" formControlName="isFree" onLabel="{{'Free'}}" offLabel="{{'Paid'}}" onIcon="{{'pi pi-check'}}" offIcon="pi pi-times" iconPos="right"></p-toggleButton>
                                    </div>
                                    <div class="field">
                                        <label for="Tariff">IsTariff</label>
                                        <p-toggleButton class="form-control" formControlName="isTariff" onLabel="{{'Tariff'}}" offLabel="{{'No Tariff'}}" onIcon="{{'pi pi-check'}}" offIcon="pi pi-times" iconPos="right"></p-toggleButton>
                                    </div>
                                    <div class="field">
                                        <label for="monthOrDays">Month Or Days</label>
                                        <p-toggleButton class="form-control" formControlName="monthOrDays" onLabel="{{'Month'}}" offLabel="{{'Days'}}" onIcon="{{'pi pi-check'}}" offIcon="pi pi-times" iconPos="right"></p-toggleButton>
                                    </div>
                                    <div class="field">
                                        <label for="siLimit">SI Limit</label>
                                        <p-toggleButton class="form-control" formControlName="siLimit" onLabel="{{'SI Limit active'}}" offLabel="{{'SI Limit inactive'}}" onIcon="{{'pi pi-check'}}" offIcon="pi pi-times" iconPos="right"></p-toggleButton>
                                    </div>
                                    <div class="field">
                                        <label for="sumInsured">Addon Selected</label>
                                        <p-toggleButton class="form-control" formControlName="isAddonSelected" onLabel="{{'Addon Selected'}}" offLabel="{{'Addon Not Selected'}}" onIcon="{{'pi pi-check'}}" offIcon="pi pi-times" iconPos="right"></p-toggleButton>
                                    </div>
                                </div> -->
                            </div>
                        </div>
                    </div>
                    <div class="col-12 md:col-3" *ngIf="this.id != 'new'">

                        <div class="card p-fluid">
                            <app-audit-trail [entityId]="this.id"
                                [entityResourcePrefix]="'addOn-covers'"></app-audit-trail>
                        </div>

                    </div>
                </div>
            </div>
        </form>
    </p-tabPanel>

    <p-tabPanel header="Addon Cover Sectors" *ngIf="this.id != 'new'">
        <app-addon-cover-sector-list [addOnCoverId]="this.id"></app-addon-cover-sector-list>
    </p-tabPanel>

</p-tabView>